---
title: "Preprosessing"
format: html
---

## Loading data and libraries

```{r}
#| message: false
library(tidyverse)
library(here)
library(readr)

df <- read_csv(here("data/med_data.csv"))
df |> head()
```

## Tidying data

There are some issues we first address

1.  Age is a high precision float that we will round to the nearest whole number
2.  Diagnosis is concatenated from multiple other colums. We will split it in two: class and group
3.  Income is a character string that we need to rank

We will address NAs later as different datapoints are needed for different analysis.

```{r}
df_tidy <- df |>
  mutate (age = round(age),
          income = factor(income,
                          levels=c("under $11k", "$11-$25k","$25-$50k",">$50k"))) |>
  separate(col=diagnosis,
           into = c("diag_group", "diag_class"),
           sep = " , ")
df_tidy |> head()
```

## Writing tidy data to disc

We now write the data to server to have a common data file we can all work from.

```{r}
write_csv(df_tidy, file=here("data/med_data_tidy.csv"))
```
